services:
    app:
      build: .
      container_name: web_app
      ports:
        - "18080:18080"
      environment:
        PORT: ${PORT}
        DB_HOST: ${DB_HOST}
        DB_USER: ${DB_USER}
        DB_PASSWORD: ${DB_PASSWORD}
        DB_NAME: ${DB_NAME}
      depends_on:
        - postgres_db
    postgres_db:
      image: postgres:14-alpine
      container_name: postgres_db
      restart: always
      healthcheck:
        test: ["CMD-SHELL", "pg_isready -d $${DB_NAME} -U $${DB_USER}"]
        interval: 10s
        timeout: 5s
        retries: 5
      environment:
        POSTGRES_USER: ${DB_USER}
        POSTGRES_PASSWORD: ${DB_PASSWORD}
        POSTGRES_DB: ${DB_NAME}
      ports:
        - 5432:5432
      volumes:
        - postgres_data:/var/lib/postgresql/data
      attach: false

volumes:
  postgres_data:
